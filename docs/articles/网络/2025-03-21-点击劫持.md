---
layout: post
title: "ç‚¹å‡»åŠ«æŒ"
date: 2025-03-21
description: "ç‚¹å‡»åŠ«æŒ"
tag: ç½‘ç»œ
---



# ä»‹ç»

**ğŸ” ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒï¼ˆClickjackingï¼‰ï¼Ÿ**

æ˜¯ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæ”»å‡»è€…åœ¨è‡ªå·±çš„ç½‘é¡µä¸­ç”¨ ``<$2>`` å·å·åµŒå…¥ä½ çš„ç½‘ç«™ï¼Œç„¶åè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ï¼Œä»è€Œåœ¨**ä½ çš„ç½‘ç«™ä¸Šæ‰§è¡Œæ“ä½œ**ã€‚

**ä¸¾ä¸ªä¾‹å­ï¼š**

â€¢	ä½ çš„ç½‘ç«™æ˜¯é“¶è¡Œåå°ï¼šhttps://bank.com/transfer

â€¢	æ”»å‡»è€…åœ¨è‡ªå·±çš„é¡µé¢é‡Œå·å·è¿™æ ·å†™ï¼š

```python
<iframe src="https://bank.com/transfer" style="opacity: 0; position: absolute; z-index: 999;"></iframe>
```

**âœ… å¦‚ä½•é˜²å¾¡ï¼Ÿ**

å°±æ˜¯ä½ åŠ çš„è¿™ä¸¤è¡Œ headerï¼š

**1. X-Frame-Options: DENY**

â€¢	å«ä¹‰ï¼šç»ä¸å…è®¸è¢«ä»»ä½•ç½‘ç«™é€šè¿‡ ``<$2>`` å¼•å…¥

â€¢	æ›¿ä»£å€¼è¿˜æœ‰ï¼š

â€¢	SAMEORIGINï¼šåªå…è®¸**åŒæºç½‘ç«™**åµŒå…¥

â€¢	ALLOW-FROM uriï¼šåªå…è®¸æŸä¸ªåŸŸååµŒå…¥ï¼ˆç°ä»£æµè§ˆå™¨ä¸æ”¯æŒäº†ï¼‰

**2. Content-Security-Policy: frame-ancestors 'none'**

â€¢	æ˜¯ CSP çš„ä¸€éƒ¨åˆ†ï¼Œä½œç”¨è·Ÿä¸Šé¢é‚£ä¸ªç±»ä¼¼ï¼Œä½†æ›´çµæ´»

â€¢	'none' è¡¨ç¤ºï¼š**æ‰€æœ‰ ``<$2>`` åµŒå¥—éƒ½ç¦æ­¢**

â€¢	è¿™ä¸ªæ¯” X-Frame-Options æ›´ç°ä»£ï¼Œæ”¯æŒæ›´å¤šåœºæ™¯

å®Œå…¨ä¸€æ ·çš„ä½œç”¨ï¼Œå®ƒå°±æ˜¯åœ¨å“åº”å¤´ä¸­åŠ ï¼š

```python
X-Frame-Options: DENY
```

å¦‚æœä½ æƒ³ï¼Œæˆ‘è¿˜å¯ä»¥å¸®ä½ æ•´ç†ä¸€ä»½æ ‡å‡†çš„ã€ŒFastAPI å®‰å…¨å“åº”å¤´é…ç½®ã€ï¼ŒåŒ…æ‹¬ï¼š
â€¢	Strict-Transport-Security
â€¢	X-Content-Type-Options
â€¢	Referrer-Policy
â€¢	Permissions-Policy

# å®‰å…¨å“åº”å¤´

é€šç”¨çš„å®‰å…¨å¤´å“åº”

```python
class SecureHeadersMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request: Request, call_next):
        response: Response = await call_next(request)

        # ğŸ’¡ å®‰å…¨ç›¸å…³å“åº”å¤´
        response.headers["X-Frame-Options"] = "DENY" # é˜²æ­¢ç‚¹å‡»åŠ«æŒ
        response.headers["Content-Security-Policy"] = "frame-ancestors 'none'" # ç°ä»£çš„iframe é™åˆ¶
        response.headers["X-Content-Type-Options"] = "nosniff" # é˜²æ­¢MIMEç±»å‹æ··æ·†
        response.headers["Referrer-Policy"] = "no-referrer" # é˜²æ­¢referreræ³„éœ²

        return response
```