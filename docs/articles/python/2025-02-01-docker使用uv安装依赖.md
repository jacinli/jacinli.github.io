# ÁõÆÂΩï

[[toc]]

## ÂÆòÊñπ‰ΩøÁî®

 FastAPI ÂÆòÊñπ Dockerfile ‰∏≠Áî®‰∫Ü‰∏§Ê¨°Ôºö

```python
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project  # ‚úÖ Á¨¨‰∏ÄÊ¨°

RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync  # ‚úÖ Á¨¨‰∫åÊ¨°
```

**ËøôÊòØ uv ÂÆòÊñπÊé®ËçêÁöÑ‰ºòÂåñÊûÑÂª∫ÊµÅÁ®ãÔºåÁõÆÁöÑÊòØ ÊúÄÂ§ßÁ®ãÂ∫¶Â§çÁî®ÁºìÂ≠òÔºåÂä†Âø´ÊûÑÂª∫ÈÄüÂ∫¶ÔºåÂêåÊó∂ÊîØÊåÅÊ∫êÁ†ÅÂèòÂåñÈáçË£Ö‰æùËµñ„ÄÇ**

**üîç Á¨¨‰∏ÄÊ¨° uv sync --frozen --no-install-project**

üìå ‰ΩúÁî®ÊòØÔºö

‚Ä¢	‚úÖ **Âè™ÂÆâË£Ö‰æùËµñ**Ôºà‰∏çÂÆâË£Ö‰Ω†È°πÁõÆ‰ª£Á†ÅÔºâ

‚Ä¢	‚úÖ ‰ΩøÁî® lock Êñá‰ª∂Á≤æÁ°ÆÊéßÂà∂ÁâàÊú¨

‚Ä¢	‚úÖ **ÊûÑÂª∫‰∏≠Èó¥Â±ÇÁºìÂ≠òÔºàintermediate layerÔºâ**

> ‚úîÔ∏è Âè™Ë¶Å‰Ω†Ê≤°Êîπ pyproject.toml Êàñ uv.lockÔºåËøô‰∏ÄÂ±ÇÊ∞∏Ëøú‰∏çÈúÄË¶ÅÈáçÂª∫ÔºÅ
> 

ËøôÊòØ Docker ÊûÑÂª∫‰∏≠ÈùûÂ∏∏ÈáçË¶ÅÁöÑ‰∏ÄÁéØ ‚Äî‚Äî Âà©Áî®Êñá‰ª∂‰∏çÂèòÊù•ÁºìÂ≠ò layerÔºåÂä†Âø´ÊûÑÂª∫ÈÄüÂ∫¶„ÄÇ

**üîÑ Á¨¨‰∫åÊ¨° uv sync**

üìå ‰ΩúÁî®ÊòØÔºö

‚Ä¢	‚úÖ **ÂÆâË£Ö‰Ω†È°πÁõÆÁöÑÊ∫êÁ†ÅÔºà‰πüÂ∞±ÊòØ app/ Êú¨Ë∫´Ôºâ**

‚Ä¢	Âõ†‰∏∫Á¨¨‰∏ÄÊ¨°Áî®‰∫Ü --no-install-projectÔºåÈ°πÁõÆ‰ª£Á†ÅÊ≤°ÊúâË£ÖËøõÂéª

> üö® Â¶ÇÊûú‰Ω†Êõ¥Êñ∞‰∫ÜÈ°πÁõÆÊ∫êÁ†ÅÔºå‰ΩÜÊ≤°Êîπ pyproject.tomlÔºåÂ∞±Âè™‰ºöËß¶ÂèëÁ¨¨‰∫åÊ¨°ÊûÑÂª∫„ÄÇ
> 

‰Ω†ÂèØ‰ª•Á±ªÊØî‰∏∫Ôºö

```python
# Á¨¨‰∏ÄÊ¨°ÔºåÂè™ÂÆâË£Ö‰æùËµñÔºå‰∏çË£ÖÈ°πÁõÆ‰ª£Á†Å
pip install --no-deps --require-hashes -r requirements.txt

# Á¨¨‰∫åÊ¨°ÔºåÊää‰Ω†ÁöÑÈ°πÁõÆÂΩìÊàê package Ë£ÖËøõÁéØÂ¢ÉÈáå
pip install .
# ÊòØ Python È°πÁõÆ‰∏≠ÈùûÂ∏∏ÈáçË¶ÅÁöÑ‰∏ÄÊ≠•ÔºåË°®Á§∫ Â∞Ü‰Ω†ÂΩìÂâçÁõÆÂΩïÔºà.Ôºâ‰∏ãÁöÑÈ°πÁõÆÂΩì‰Ωú‰∏Ä‰∏™ Package ÂÆâË£ÖÂà∞ÂΩìÂâç Python ÁéØÂ¢É‰∏≠„ÄÇ

```

ËøôÊ†∑‰Ω†ÊØèÊ¨°ÂÜô‰ª£Á†ÅÊîπÁöÑÊòØ .py Êñá‰ª∂ËÄå‰∏çÊòØ‰æùËµñÔºåDocker Â∞±‰∏ç‰ºöÈáçÊñ∞ÊûÑÂª∫ÂÜó‰ΩôÂ±Ç ‚úÖ

| **Á¨¨‰∏ÄÊ¨°** uv sync --frozen --no-install-project | **Á¨¨‰∫åÊ¨°** uv sync |
| --- | --- |
| ÂÆâË£Ö‰æùËµñÈ°πÔºàÊûÑÂª∫ÁºìÂ≠òÂ±ÇÔºâ | ÂÆâË£ÖÈ°πÁõÆÊú¨Ë∫´ |
| ‰∏ç‰ºöÂÆâË£Ö‰Ω† app/ Ê∫êÁ†Å | ‰ºöË£ÖÊ∫êÁ†ÅÂà∞ËôöÊãüÁéØÂ¢É |
| ÂØπÂ∫î lock Êñá‰ª∂ÔºàÊõ¥ÂèØÊéßÔºâ | Âø´ÈÄüÈáçÂª∫È°πÁõÆÂ±Ç |
| ÊúâÂà©‰∫éÊûÑÂª∫ÊÄßËÉΩ | ÊúâÂà©‰∫éÁÉ≠Êõ¥Êñ∞ÂíåÊú¨Âú∞ÊµãËØï |

ÂèØ‰ª•Ôºå‰ΩÜ‰Ω†Â∞±‰ºöÂ§±Âéª **‰∏≠Èó¥Â±ÇÁºìÂ≠ò‰ºòÂåñÁöÑÂ•ΩÂ§Ñ**ÔºåÊØèÊ¨°Êîπ .py ÈÉΩ‰ºöÈáçÊñ∞Ë£ÖÂÖ®ÈÉ®‰æùËµñ ‚ùå

**‚úÖ ‰∏∫‰ªÄ‰πà FastAPI ÂÆòÊñπ‰∏çÂÜô COPYÔºü**

Âõ†‰∏∫‰ªñ‰ª¨‰ΩøÁî®ÁöÑÊòØ [**BuildKit ÁöÑÂ§öÈò∂ÊÆµÊûÑÂª∫ + bind mount ‰ºòÂåñÊñπÊ°à**](https://docs.docker.com/build/buildkit/)Ôºö

```
‚Ä¢	Á¨¨‰∏ÄÊ¨° RUN uv sync --frozen --no-install-project ‰ΩøÁî®ÊåÇËΩΩÁöÑ pyproject.toml Âíå uv.lock ÂÆâË£Ö‰æùËµñÔºà‰ΩÜ‰∏çÂÆâË£ÖÈ°πÁõÆÔºâ
‚Ä¢	ÊúÄÁªà‰ºöÂú®ÂêéÈù¢Èò∂ÊÆµÔºåÂÜç‰ΩøÁî® COPY . . ÊääÈ°πÁõÆ‰ª£Á†ÅÊã∑Ë¥ùËøõÊù•

```

| **Ê≠•È™§** | **ÊòØÂê¶ÂêàÁêÜ** | **ËØ¥Êòé** |
| --- | --- | --- |
| ËÆæÁΩÆÂü∫Á°ÄÈïúÂÉè | ‚úÖ | python:3.12-slim ËäÇÁúÅ‰ΩìÁßØ |
| ‰ΩøÁî® uv ÊûÑÂª∫ | ‚úÖ | Âø´ÈÄüÈ´òÊïà„ÄÅÁé∞‰ª£‰æùËµñÂ∑•ÂÖ∑ |
| ÁºìÂ≠ò‰æùËµñÂÆâË£ÖÂ±Ç | ‚úÖ | Âä†ÈÄüÊûÑÂª∫„ÄÅÂ§çÁî®ÁºìÂ≠ò |
| ÂàÜÈò∂ÊÆµ COPY + uv sync | ‚úÖ | ÂáèÂ∞ëÂèòÊõ¥Ëß¶ÂèëÈáçË£Ö |
| PYTHONPATH=. | ‚úÖ | ÈÄÇÈÖç from app.xxx ÂØºÂÖ• |
| CMD ‰ΩøÁî® uvicorn | ‚úÖ | ÈÄÇÂêàÁ∫ø‰∏äÈÉ®ÁΩ≤„ÄÅASGI ÂéüÁîü |

## ÂºÄÁÆ±Âç≥Áî®ÁöÑDockfile

```python
FROM python:3.12-slim AS builder

WORKDIR /app

# ËÆæÁΩÆÊó∂Âå∫‰∏∫ UTC+8
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

COPY --from=ghcr.io/astral-sh/uv:0.5.11 /uv /uvx /bin/

ENV PATH="/app/.venv/bin:$PATH"
ENV UV_COMPILE_BYTECODE=1
ENV UV_LINK_MODE=copy

# Â§çÂà∂È°πÁõÆÊñá‰ª∂Âà∞ÂÆπÂô®‰∏≠
COPY . /app/

RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project

ENV PYTHONPATH=.

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--log-level", "warning"]
```