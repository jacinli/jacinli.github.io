**ç»Ÿä¸€æ³¨å†Œå·¥å…·å‡½æ•°ã€ç»Ÿä¸€è°ƒç”¨æ‰§è¡Œ**çš„æ¡†æ¶ï¼Œå°±åƒä½ ç°åœ¨åšçš„é‚£æ · â€”â€” ç±»ä¼¼äºä¸€ä¸ªã€Œå·¥å…·å·¥å‚ã€ã€‚

```python
from typing import Dict, Callable, Any
import inspect
import json

# å·¥å…·å·¥å‚åŸºç±»
class BaseTool:
    registry: Dict[str, Callable] = {}

    @classmethod
    def register(cls, fn: Callable):
        """æ³¨å†Œå·¥å…·å‡½æ•°åˆ°å·¥å‚"""
        cls.registry[fn.__name__] = fn
        return fn

    @classmethod
    def get_tools(cls):
        """è¿”å›æ‰€æœ‰æ³¨å†Œçš„å·¥å…·å®šä¹‰ï¼ˆç»™ OpenAIï¼‰"""
        tools = []
        for name, fn in cls.registry.items():
            sig = inspect.signature(fn)
            parameters = {
                "type": "object",
                "properties": {},
                "required": [],
            }
            for param in sig.parameters.values():
                parameters["properties"][param.name] = {
                    "type": "string",
                    "description": f"{param.name} å‚æ•°"
                }
                parameters["required"].append(param.name)

            tools.append({
                "type": "function",
                "function": {
                    "name": name,
                    "description": fn.__doc__ or "æ— æè¿°",
                    "parameters": parameters
                }
            })
        return tools

    @classmethod
    def call(cls, name: str, args: Dict[str, Any]) -> str:
        """æ ¹æ®åç§°è°ƒç”¨å·¥å…·å‡½æ•°"""
        if name not in cls.registry:
            raise ValueError(f"æœªæ³¨å†Œçš„å·¥å…·å‡½æ•°: {name}")
        return cls.registry[name](**args)

# ==============================

# å­ç±»å·¥å…·é›†ï¼šè‡ªåŠ¨æ³¨å†Œ
class MyTools(BaseTool):

    @BaseTool.register
    def get_weather(location: str) -> str:
        """è·å–åŸå¸‚å¤©æ°”ä¿¡æ¯"""
        return f"â˜€ï¸ å½“å‰ {location} æ™´å¤©ï¼Œæ¸©åº¦ 25Â°C"

    @BaseTool.register
    def get_time(city: str) -> str:
        """è·å–å½“å‰æ—¶é—´"""
        return f"ğŸ•’ å½“å‰ {city} æ—¶é—´ä¸º 12:00"

# ==============================

# ğŸ§ª æµ‹è¯•å·¥å‚è°ƒç”¨
if __name__ == "__main__":
    tools = BaseTool.get_tools()
    print("æ³¨å†Œçš„å·¥å…·å®šä¹‰ï¼ˆå¯ä¼ ç»™ OpenAI çš„ toolsï¼‰:")
    print(json.dumps(tools, indent=2, ensure_ascii=False))

    print("\nâœ… å·¥å‚è°ƒç”¨ get_weather:")
    result = BaseTool.call("get_weather", {"location": "åŒ—äº¬"})
    print(result)

    print("\nâœ… å·¥å‚è°ƒç”¨ get_time:")
    result = BaseTool.call("get_time", {"city": "ä¸Šæµ·"})
    print(result)
```

| **æœºåˆ¶** | **ä½œç”¨** |
| --- | --- |
| @BaseTool.register | è‡ªåŠ¨æ³¨å†Œå·¥å…·å‡½æ•°è¿›å·¥å‚ |
| BaseTool.call(name, args) | æ ¹æ®åå­—è‡ªåŠ¨æ‰¾åˆ°å‡½æ•°å¹¶æ‰§è¡Œ |
| BaseTool.get_tools() | ç”Ÿæˆ OpenAI æ‰€éœ€çš„ tools æè¿° |

**ğŸ” @BaseTool.register æ˜¯ä»€ä¹ˆï¼Ÿ**

å®ƒæ˜¯ä¸€ä¸ª**ç±»æ–¹æ³•è£…é¥°å™¨**ï¼Œè£…é¥°çš„ä½œç”¨æ˜¯æŠŠå‡½æ•°**æ³¨å†Œåˆ° BaseTool.registry è¿™ä¸ªå­—å…¸ä¸­**ï¼Œä¾›åç»­ç»Ÿä¸€è°ƒç”¨ã€‚

è¿™ä¸ª @classmethod çš„ä½œç”¨æ˜¯â€”â€”å°†ä¸€ä¸ªå‡½æ•° fn æ³¨å†Œè¿›å½“å‰ç±»çš„ registry å­—å…¸ä¸­ï¼Œé”®æ˜¯å‡½æ•°åï¼Œå€¼æ˜¯å‡½æ•°æœ¬ä½“ã€‚

```python
class MyTools(BaseTool):

    @BaseTool.register
    def get_weather(location: str) -> str:
        return f"{location} ä»Šå¤©æ™´ï¼Œ25Â°C"
```

ç­‰ä»·äº:

```python
def get_weather(location: str) -> str:
    return f"{location} ä»Šå¤©æ™´ï¼Œ25Â°C"

BaseTool.register(get_weather)

{
  "get_weather": <function get_weather(...)>,
  "get_time": <function get_time(...)>
}
```

å½“ä½ æ‰§è¡Œï¼š

```python
for name, fn in cls.registry.items():
```

| **name** | **fn** |
| --- | --- |
| â€œget_weatherâ€ | `<function get_weather>` |
| â€œget_timeâ€ | `<function get_time>` |

Python çš„ inspect.signature(fn) æ˜¯æ ‡å‡†åº“ä¸­çš„å‡½æ•°ï¼Œç”¨æ¥**è·å–å‡½æ•°çš„å‚æ•°ä¿¡æ¯**ã€‚

```python
def get_weather(location: str):
    pass

sig = inspect.signature(get_weather)
print(sig)  # (location: str)
```

| **ä»£ç ** | **ä½œç”¨** |
| --- | --- |
| cls.registry.items() | è·å–æ³¨å†Œçš„æ‰€æœ‰å‡½æ•°åå’Œå‡½æ•°æœ¬ä½“ |
| inspect.signature(fn) | è·å–å‡½æ•°çš„å‚æ•°å®šä¹‰ |
| æ„å»º parameters å­—å…¸ | è½¬æˆ OpenAI tools èƒ½è¯†åˆ«çš„æ ¼å¼ |